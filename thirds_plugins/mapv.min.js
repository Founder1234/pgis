!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.mapv=t.mapv||{})}(this,function(t){"use strict";function e(){var t=document.createElement("canvas"),e=t.getContext("2d"),n=e.createLinearGradient(0,0,256,0);n.addColorStop(1,"#F00"),n.addColorStop(.6,"#FFFC00"),n.addColorStop(.3,"#00FF1D"),n.addColorStop(0,"#000BFF"),e.fillStyle=n,e.fillRect(0,0,256,1);var i=e.getImageData(0,0,256,1);return i.data}function n(t){t=t||{},this.gradient=t.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=t.maxSize||35,this.max=t.max||100,this.initPalette()}function i(t){function e(t){requestAnimationFrame(e),n.render()}this.container=t,this.init();var n=this;this.group=new THREE.Group,this.center=[105,33],requestAnimationFrame(e)}function a(t){function e(t){requestAnimationFrame(e),n.render()}this.container=t,this.init();var n=this;requestAnimationFrame(e)}function o(t){for(var e=V;e<X;++e){for(var n=G[e][0],i=G[e][1],a=G[e][2],o=G[e][3],g=.04*Math.random(),h=[],c=8,p=0;p<c+1;p++){var u=180*p/c,d=t+Math.sin(u*Math.PI/180)*g,f=r(n,i,a,o,p/c),v=s(f.lat,f.lng,d);h.push(new THREE.Vector3(v.x,v.y,v.z))}var m=new THREE.SplineCurve3(h);J.push(m);var y=m.getLength();Y.push(y),l(e)}}function r(t,e,n,i,a){t=t*Math.PI/180,e=e*Math.PI/180,n=n*Math.PI/180,i=i*Math.PI/180;var o=2*Math.asin(Math.sqrt(Math.pow(Math.sin((t-n)/2),2)+Math.cos(t)*Math.cos(n)*Math.pow(Math.sin((e-i)/2),2))),r=Math.sin((1-a)*o)/Math.sin(o),s=Math.sin(a*o)/Math.sin(o),g=r*Math.cos(t)*Math.cos(e)+s*Math.cos(n)*Math.cos(i),h=r*Math.cos(t)*Math.sin(e)+s*Math.cos(n)*Math.sin(i),c=r*Math.sin(t)+s*Math.sin(n),l=180*Math.atan2(c,Math.sqrt(Math.pow(g,2)+Math.pow(h,2)))/Math.PI,p=180*Math.atan2(h,g)/Math.PI;return{lat:l,lng:p}}function s(t,e,n){var i=(90-t)*Math.PI/180,a=(360-e)*Math.PI/180;return{x:n*Math.sin(i)*Math.cos(a),y:n*Math.cos(i),z:n*Math.sin(i)*Math.sin(a)}}function g(){for(var t=32,e=new THREE.BufferGeometry,n=new THREE.LineBasicMaterial({color:16776960,vertexColors:THREE.VertexColors,transparent:!0,opacity:Q,depthTest:!0,depthWrite:!1,linewidth:1.0001}),i=new Float32Array(3*G.length*2*t),a=new Float32Array(3*G.length*2*t),o=V;o<X;++o)for(var r=0;r<t-1;++r){var s=J[o].getPoint(r/(t-1)),g=J[o].getPoint((r+1)/(t-1));i[6*(o*t+r)+0]=s.x,i[6*(o*t+r)+1]=s.y,i[6*(o*t+r)+2]=s.z,i[6*(o*t+r)+3]=g.x,i[6*(o*t+r)+4]=g.y,i[6*(o*t+r)+5]=g.z,a[6*(o*t+r)+0]=1,a[6*(o*t+r)+1]=.4,a[6*(o*t+r)+2]=1,a[6*(o*t+r)+3]=1,a[6*(o*t+r)+4]=.4,a[6*(o*t+r)+5]=1}return e.addAttribute("position",new THREE.BufferAttribute(i,3)),e.addAttribute("color",new THREE.BufferAttribute(a,3)),e.computeBoundingSphere(),new THREE.Line(e,n,THREE.LinePieces)}function h(){j=new THREE.BufferGeometry;var t=G.length;Z=new Float32Array(3*t);for(var e=new Float32Array(3*t),n=new Float32Array(t),i=0;i<t;i++)Z[3*i+0]=0,Z[3*i+1]=0,Z[3*i+2]=0,e[3*i+0]=Math.random(),e[3*i+1]=Math.random(),e[3*i+2]=Math.random(),n[i]=.1;j.addAttribute("position",new THREE.BufferAttribute(Z,3)),j.addAttribute("customColor",new THREE.BufferAttribute(e,3)),j.addAttribute("size",new THREE.BufferAttribute(n,1)),j.computeBoundingBox();var a={color:{type:"c",value:new THREE.Color(16777215)},texture:{type:"t",value:THREE.ImageUtils.loadTexture("images/point.png")}},o=new THREE.ShaderMaterial({uniforms:a,vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,blending:THREE.AdditiveBlending,depthTest:!0,depthWrite:!1,transparent:!0});return new THREE.Points(j,o)}function c(){if(j){j.attributes.position.needsUpdate=!0;for(var t=V;t<X;++t)if(Date.now()>K[t]){var e=p(Date.now()-K[t],0,1,$[t]-K[t]);(e<0||tt)&&(e=0,l(t));var n=J[t].getPoint(e);Z[3*t+0]=n.x,Z[3*t+1]=n.y,Z[3*t+2]=n.z}}}function l(t){var e=(et-nt)/(it-nt),n=(1-e)*Y[t]*8e4,i=Date.now()+5e3*Math.random();K[t]=i,$[t]=i+n}function p(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e}function u(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}function d(t){var e=window.devicePixelRatio;t.canvas.width=t.canvas.width*e,t.canvas.height=t.canvas.height*e,t.canvas.style.width=t.canvas.width/e+"px",t.canvas.style.height=t.canvas.height/e+"px",t.scale(e,e)}function f(){this._subscribers={}}function v(t,e){this._options=e||{},this._data=[],t&&this.add(t)}function m(t){if("undefined"==typeof document)var e=require("canvas"),n=new e;else var n=document.createElement("canvas");var i=n.getContext("2d"),a=t/2,o=t+a,r=1e4;return n.width=n.height=2*o,i.shadowBlur=a,i.shadowColor="black",i.shadowOffsetX=i.shadowOffsetY=r,i.beginPath(),i.arc(o-r,o-r,t,0,2*Math.PI,!0),i.closePath(),i.fill(),n}function y(t,e,n){for(var i,a=n.maxOpacity||.8,o=3,r=t.length;o<r;o+=4)i=4*t[o],t[o]/256>a&&(t[o]=256*a),t[o-3]=e[i],t[o-2]=e[i+1],t[o-1]=e[i+2]}function w(t,e,i){var a=i.max||100,o=i._size;void 0==o&&(o=i.size,void 0==o&&(o=13));var r=new n({gradient:i.gradient,max:a}),s=m(o),g=e,h={};g.forEach(function(t,e){var n=void 0===t.count?1:t.count,i=Math.min(1,n/a).toFixed(2);h[i]=h[i]||[],h[i].push(t)});for(var c in h)if(!isNaN(c)){var l=h[c];t.beginPath(),i.withoutAlpha||(t.globalAlpha=c),l.forEach(function(e,n){if(e.geometry){var o=e.geometry._coordinates||e.geometry.coordinates,r=e.geometry.type;if("Point"===r){var g=void 0===e.count?1:e.count;t.globalAlpha=g/a,t.drawImage(s,o[0]-s.width/2,o[1]-s.height/2)}else"LineString"===r&&at.draw(t,e,i)}}),t.strokeStyle=r.getColor(c*a),t.stroke()}}function x(t,e,n){var i=n.strength||.3;t.strokeStyle="rgba(0,0,0,"+i+")",n=n||{};var a=e.get();if(t.save(),console.time("drawGray"),w(t,a,n),console.timeEnd("drawGray"),!n.absolute){console.time("changeColor");var o=t.getImageData(0,0,t.canvas.width,t.canvas.height);y(o.data,rt.getImageData({defaultGradient:n.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"}}),n),console.timeEnd("changeColor"),t.putImageData(o,0,0),t.restore()}}function E(t,e,n){var i=60*n+30,a=Math.PI/180*i;return[t.x+e*Math.cos(a),t.y+e*Math.sin(a)]}function _(t){var e=t.split("|");return e[0]=e[0].split(","),{lng:parseFloat(e[0][0]),lat:parseFloat(e[0][1])}}function M(t){for(var e=[],n=0;n<t.length-1;n++){var i=b(t[n],t[n+1]);i&&i.length>0&&(e=e.concat(i))}return e}function b(t,e){if(!t||!e)return null;var n,i,a,o,r,s,g,h=function(t){return 1-2*t+t*t},c=function(t){return 2*t-2*t*t},l=function(t){return t*t},p=[],u=40,d=0,f=0;if("undefined"==typeof e)return void("undefined"!=typeof p&&(p=[]));var v=parseFloat(t.lat),m=parseFloat(e.lat),y=parseFloat(t.lng),w=parseFloat(e.lng);for(w>y&&parseFloat(w-y)>180&&y<0&&(y=parseFloat(360+y)),y>w&&parseFloat(y-w)>180&&w<0&&(w=parseFloat(360+w)),s=0,g=0,m==v?(n=0,i=y-w):w==y?(n=Math.PI/2,i=v-m):(n=Math.atan((m-v)/(w-y)),i=(m-v)/Math.sin(n)),0==g&&(g=n+Math.PI/5),a=i/2,r=a*Math.cos(g)+y,o=a*Math.sin(g)+v,d=0;d<u+1;d++)p.push([y*h(f)+r*c(f)+w*l(f),v*h(f)+o*c(f)+m*l(f)]),f+=1/u;return p}function S(t){this.splitList=t||{other:1}}function R(t){this.splitList=t||[{start:0,value:"red"}]}function C(t,e){return function(n){return Math.max(Math.min(n,e),t)}}function T(t,e){var n=C(0,1);return function(i){return n((i-t)/(e-t))}}function z(t,e){function n(n){return i(t*(1-n)+n*e)}var i=C(t,e);return n.invert=function(){return T(t,e)},n}function L(t,e){if(!e.steps)throw new Error("steps option missing");this.options=e,this.running=!1,this._tick=this._tick.bind(this),this._t0=+new Date,this.callback=t,this._time=0,this.itemsReady=!1,this.options.animationDelay=0,this.options.maxDelta=.2,this.options.loop=void 0===e.loop||e.loop,this.steps(e.steps),e.stepsRange&&void 0!==e.stepsRange.start&&void 0!==e.stepsRange.end&&this.stepsRange(e.stepsRange.start,e.stepsRange.end)}function H(t){this.options=t||{},this.paneName=this.options.paneName||"labelPane",this.zIndex=this.options.zIndex||0,this.mixBlendMode=this.options.mixBlendMode||null,this._map=t.map,this._lastDrawTime=null,this.show()}function k(t,e,n){function i(i){var r=Math.pow(2,18-t.getZoom()),h=t.getMapType().getProjection(),c=h.lngLatToPoint(t.getCenter()),l=new BMap.Pixel(c.x-t.getSize().width/2*r,c.y+t.getSize().height/2*r),p=this.canvas.getContext("2d");if(g){if(void 0===i)return;p.save(),p.globalCompositeOperation="destination-out",p.fillStyle="rgba(0, 0, 0, .1)",p.fillRect(0,0,p.canvas.width,p.canvas.height),p.restore()}else u(p);for(var d in a.options)p[d]=a.options[d];var f={transferCoordinate:function(e){if("bd09mc"==a.options.coordType){var n=(e[0]-l.x)/r,i=(l.y-e[1])/r;return[n,i]}var o=t.pointToPixel(new BMap.Point(e[0],e[1]));return[o.x,o.y]}};void 0!==i&&(f.filter=function(t){var e=s.trails||5;return!!(i&&t.time>i-e&&t.time<i)}),o=e.get(f);var m=a.options.draw;if("bubble"==m||"intensity"==m||"category"==m||"choropleth"==m||"simple"==m)for(var y=0;y<o.length;y++){var w=o[y];"bubble"==a.options.draw?o[y]._size=a.intensity.getSize(w.count):o[y]._size=void 0,"intensity"==a.options.draw?"LineString"===o[y].geometry.type?o[y].strokeStyle=a.intensity.getColor(w.count):o[y].fillStyle=a.intensity.getColor(w.count):"category"==a.options.draw?o[y].fillStyle=a.category.get(w.count):"choropleth"==a.options.draw&&(o[y].fillStyle=a.choropleth.get(w.count))}if(!(a.options.minZoom&&t.getZoom()<a.options.minZoom||a.options.maxZoom&&t.getZoom()>a.options.maxZoom)){switch("m"==a.options.unit&&a.options.size?a.options._size=a.options.size/r:a.options._size=a.options.size,a.options.draw){case"heatmap":st.draw(p,new v(o),a.options);break;case"grid":case"honeycomb":var x=t.pointToPixel(new BMap.Point(0,0));a.options.offset={x:x.x,y:x.y},"grid"==a.options.draw?gt.draw(p,new v(o),a.options):ht.draw(p,new v(o),a.options);break;case"text":Et.draw(p,new v(o),a.options);break;case"icon":_t.draw(p,o,a.options);break;case"clip":p.save(),p.fillStyle=n.fillStyle||"rgba(0, 0, 0, 0.5)",p.fillRect(0,0,p.canvas.width,p.canvas.height),ot.draw(p,o,a.options),p.beginPath(),at.drawDataSet(p,new v(o),a.options),p.clip(),u(p),p.restore();break;default:ot.draw(p,o,a.options)}n.updateCallback&&n.updateCallback(i)}}e instanceof v||(e=new v(e));var a=this,o=null;n=n||{},a.init(n),a.argCheck(n),a.map=t;var r=this.canvasLayer=new H({map:t,paneName:n.paneName,mixBlendMode:n.mixBlendMode,zIndex:n.zIndex,update:i});e.on("change",function(){r.draw()});var s=a.options.animation,g=s&&!(s.enabled===!1);if("time"==a.options.draw||g){var h=new L(function(t){i.call(r,t)},{steps:s.steps||100,stepsRange:s.stepsRange||100,animationDuration:s.duration||10});h.start(),t.addEventListener("movestart",function(){h.pause()}),t.addEventListener("moveend",function(){h.start()})}a.options.methods&&a.options.methods.click&&(t.setDefaultCursor("default"),t.addEventListener("click",function(t){for(var n=t.pixel,i=r.canvas.getContext("2d"),o=e.get(),s=0;s<o.length;s++)i.beginPath(),at.draw(i,o[s],a.options),i.isPointInPath(n.x*r.devicePixelRatio,n.y*r.devicePixelRatio)&&a.options.methods.click(o[s],t)}))}function A(t){function e(t,e){return function(){e.apply(t)}}this.isAdded_=!1,this.isAnimated_=!1,this.paneName_=A.DEFAULT_PANE_NAME_,this.updateHandler_=null,this.resizeHandler_=null,this.topLeft_=null,this.centerListener_=null,this.resizeListener_=null,this.needsResize_=!0,this.requestAnimationFrameId_=null;var n=document.createElement("canvas");n.style.position="absolute",n.style.top=0,n.style.left=0,n.style.pointerEvents="none",this.canvas=n,this.canvasCssWidth_=300,this.canvasCssHeight_=150,this.resolutionScale_=1,this.repositionFunction_=e(this,this.repositionCanvas_),this.resizeFunction_=e(this,this.resize_),this.requestUpdateFunction_=e(this,this.update_),t&&this.setOptions(t)}function I(t,e,i){function a(){var n=c.canvas.getContext("2d");u(n);for(var a in i)n[a]=i[a];for(var h=0,l=0,p=0,d=t.getProjection(),f=Math.pow(2,t.zoom)*g,m=d.fromLatLngToPoint(c.getTopLeft()),y=e.get({transferCoordinate:function(t){var e=new google.maps.LatLng(t[1],t[0]),n=d.fromLatLngToPoint(e),i={x:(n.x-m.x)*f,y:(n.y-m.y)*f};return[i.x,i.y]}}),w=0;w<y.length;w++){var x=y[w];"bubble"==i.draw?y[w].size=o.getSize(x.count):"intensity"==i.draw?"LineString"===y[w].geometry.type?y[w].strokeStyle=o.getColor(x.count):y[w].fillStyle=o.getColor(x.count):"category"==i.draw?y[w].fillStyle=r.get(x.count):"choropleth"==i.draw&&(y[w].fillStyle=s.get(x.count))}Math.max(Math.max(h,l),p);if("heatmap"==i.draw)st.draw(n,new v(y),i);else if("grid"==i.draw||"honeycomb"==i.draw){for(var E=e.get(),_=E[0].geometry.coordinates[0],M=E[0].geometry.coordinates[1],w=1;w<E.length;w++)E[w].geometry.coordinates[0]<_&&(_=E[w].geometry.coordinates[0]),E[w].geometry.coordinates[1]>M&&(M=E[w].geometry.coordinates[1]);var b=new google.maps.LatLng(_,M),S=d.fromLatLngToPoint(b);i.offset={x:(S.x-m.x)*f,y:(S.y-m.y)*f},"grid"==i.draw?gt.draw(n,new v(y),i):ht.draw(n,new v(y),i)}else console.log("hehe"),ot.draw(n,new v(y),i)}var o=new n({maxSize:i.maxSize,gradient:i.gradient,max:i.max}),r=new S(i.splitList),s=new R(i.splitList),g=window.devicePixelRatio||1,h={map:t,animate:!1,updateHandler:a,resolutionScale:g},c=new A(h)}function F(t){this.options=t||{},this.paneName=this.options.paneName||"labelPane",this.zIndex=this.options.zIndex||0,this.mixBlendMode=this.options.mixBlendMode||null,this._map=t.map,this._lastDrawTime=null,this.initialize(map)}function D(t,e,n){function i(i){var r=Math.pow(2,18-t.getZoom()),h=t.getView().calculateExtent(t.getSize()),c=(t.getPixelFromCoordinate(ol.extent.getTopLeft(h)),this.canvas.getContext("2d"));if(g){if(void 0===i)return;c.save(),c.globalCompositeOperation="destination-out",c.fillStyle="rgba(0, 0, 0, .1)",c.fillRect(0,0,c.canvas.width,c.canvas.height),c.restore()}else u(c);for(var l in a.options)c[l]=a.options[l];var p={transferCoordinate:function(e){var n=t.getPixelFromCoordinate(e);return[n[0],n[1]]}};void 0!==i&&(p.filter=function(t){var e=s.trails||5;return!!(i&&t.time>i-e&&t.time<i)}),o=e.get(p);var d=a.options.draw;if("bubble"==d||"intensity"==d||"category"==d||"choropleth"==d||"simple"==d)for(var f=0;f<o.length;f++){var m=o[f];"bubble"==a.options.draw?o[f]._size=a.intensity.getSize(m.count):o[f]._size=void 0,"intensity"==a.options.draw?"LineString"===o[f].geometry.type?o[f].strokeStyle=a.intensity.getColor(m.count):o[f].fillStyle=a.intensity.getColor(m.count):"category"==a.options.draw?o[f].fillStyle=a.category.get(m.count):"choropleth"==a.options.draw&&(o[f].fillStyle=a.choropleth.get(m.count))}if(!(a.options.minZoom&&t.getZoom()<a.options.minZoom||a.options.maxZoom&&t.getZoom()>a.options.maxZoom)){switch("m"==a.options.unit&&a.options.size?a.options._size=a.options.size/r:a.options._size=a.options.size,a.options.draw){case"heatmap":st.draw(c,new v(o),a.options);break;case"grid":case"honeycomb":var y=t.pointToPixel(new BMap.Point(0,0));a.options.offset={x:y.x,y:y.y},"grid"==a.options.draw?gt.draw(c,new v(o),a.options):ht.draw(c,new v(o),a.options);break;case"text":Et.draw(c,new v(o),a.options);break;case"icon":_t.draw(c,o,a.options);break;case"clip":c.save(),c.fillStyle=n.fillStyle||"rgba(0, 0, 0, 0.5)",c.fillRect(0,0,c.canvas.width,c.canvas.height),ot.draw(c,o,a.options),c.beginPath(),at.drawDataSet(c,new v(o),a.options),c.clip(),u(c),c.restore();break;default:ot.draw(c,o,a.options)}n.updateCallback&&n.updateCallback(i)}}e instanceof v||(e=new v(e));var a=this,o=null;n=n||{},a.init(n),a.argCheck(n),a.map=t;var r=this.canvasLayer=new F({map:t,paneName:n.paneName,mixBlendMode:n.mixBlendMode,zIndex:n.zIndex,update:i});e.on("change",function(){r.draw()});var s=a.options.animation,g=s&&!(s.enabled===!1);if("time"==a.options.draw||g){var h=this.animator=new L(function(t){i.call(r,t)},{steps:s.steps||100,stepsRange:s.stepsRange||100,animationDuration:s.duration||10});h.start(),t.on("moveend",function(){h.start()})}else t.on("moveend",function(){r._draw()});t.on("pointerdrag",function(){var t=r.canvas.getContext("2d");u(t)}),t.addMapEventListener("zoomchange",function(){var t=r.canvas.getContext("2d");u(t)}),a.options.methods&&a.options.methods.click&&t.addMapEventListener("singleclick",function(t){for(var n=t.pixel,i=r.canvas.getContext("2d"),o=e.get(),s=0;s<o.length;s++)i.beginPath(),at.draw(i,o[s],a.options),i.isPointInPath(n[0]*r.devicePixelRatio,n[1]*r.devicePixelRatio)&&a.options.methods.click(o[s],t)})}var B="2.0.1",q=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,a){var s={key:t,arg:e,resolve:n,reject:a,next:null};r?r=r.next=s:(o=r=s,i(t,e))})}function i(n,o){try{var r=e[n](o),s=r.value;s instanceof t?Promise.resolve(s.value).then(function(t){i("next",t)},function(t){i("throw",t)}):a(r.done?"return":"normal",r.value)}catch(t){a("throw",t)}}function a(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}o=o.next,o?i(o.key,o.arg):r=null}var o,r;this._invoke=n,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),N=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),O=function(){function t(e,n){q(this,t),this.dom=e,this.opt=n,this.init()}return N(t,[{key:"init",value:function(){function t(){requestAnimationFrame(t),o.render(i,a),r.update()}var n=1,i=new THREE.Scene,a=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.01,1e8),o=new THREE.WebGLRenderer,r=new THREE.OrbitControls(a,o.domElement);r.enableDamping=!0,r.dampingFactor=.25,o.setSize(this.dom.clientWidth,this.dom.clientHeight),this.dom.appendChild(o.domElement);var s=new THREE.PlaneGeometry(80*n,50*n,10,10),g=new THREE.MeshBasicMaterial({color:5789784,wireframe:!0}),h=window.cube=new THREE.Mesh(s,g);h.rotateX(-Math.PI/2),i.add(h),a.position.y=50*n,a.position.z=50*n,a.lookAt(new THREE.Vector3(0,0,0)),t();var c=this.opt.grid.size*n,l={},p=1/0,u=-(1/0);for(var d in data){var f=parseInt(data[d].lng*n/c)*c,v=parseInt(data[d].lat*n/c)*c;l[f+"_"+v]=l[f+"_"+v]||0,l[f+"_"+v]++,u=Math.max(u,l[f+"_"+v]),p=Math.min(p,l[f+"_"+v])}var m=e(),y=new THREE.Object3D;for(var d in l){var w=u==p?0:(l[d]-p)/(u-p),x=parseInt(w*(m.length/4))-1;x=x<0?0:x;var E=m[4*x].toString(16);E=E.length<2?"0"+E:E;var _=m[4*x+1].toString(16);_=_.length<2?"0"+_:_;var M=m[4*x+2].toString(16);M=M.length<2?"0"+M:M;var b=1.5*l[d],s=new THREE.BoxGeometry(.9*c,b,.9*c),g=new THREE.MeshBasicMaterial({color:"#"+E+_+M}),h=new THREE.Mesh(s,g),S=d.split("_");h.position.x=S[0]-this.opt.center.lng*n,h.position.y=b/2,h.position.z=this.opt.center.lat*n-S[1],y.add(h)}i.add(y)}}]),t}();n.prototype.initPalette=function(){var t=this.gradient;if("undefined"==typeof document)var e=require("canvas"),n=new e(256,1);else var n=document.createElement("canvas");n.width=256,n.height=1;var i=this.paletteCtx=n.getContext("2d"),a=i.createLinearGradient(0,0,256,1);for(var o in t)a.addColorStop(parseFloat(o),t[o]);i.fillStyle=a,i.fillRect(0,0,256,1)},n.prototype.getColor=function(t){var e=this.max;t>e&&(t=e);var n=4*Math.floor(t/e*255),i=this.paletteCtx.getImageData(0,0,256,1).data;return"rgba("+i[n]+", "+i[n+1]+", "+i[n+2]+", "+i[n+3]/256+")"},n.prototype.getSize=function(t){var e=0,n=this.max,i=this.maxSize;return t>n&&(t=n),e=t/n*i},i.prototype.init=function(){this.intensity=new n({gradient:{0:"#006bab",1:"#002841"},max:100});var t=this.container.offsetWidth,e=this.container.offsetHeight,i=this.camera=new THREE.PerspectiveCamera(40,t/e,.01,9e3);i.position.x=0,i.position.y=0,i.position.z=85,i.lookAt(new THREE.Vector3(0,0,0));var a=this.scene=new THREE.Scene,o=this.renderer=new THREE.WebGLRenderer({alpha:!0});o.setPixelRatio(window.devicePixelRatio),o.setSize(t,e),this.container.appendChild(o.domElement);var r=THREE.ImageUtils.loadTexture("images/china.png"),s=new THREE.MeshBasicMaterial({map:r,transparent:!0,side:THREE.DoubleSide}),g=new THREE.PlaneGeometry(100,100,1,1),h=new THREE.Mesh(g,s);h.position.x=0,h.position.y=0,h.position.z=0;var c=new THREE.PointLight("rgb(50, 50, 250)");c.position.set(0,0,35),a.add(c);var l=20,p=new THREE.Geometry,u=new THREE.QuadraticBezierCurve3;u.v0=new THREE.Vector3(0,0,0),u.v1=new THREE.Vector3(20,20,0),u.v2=new THREE.Vector3(40,40,0);for(var d=0;d<l;d++)p.vertices.push(u.getPoint(d/l));var f=new THREE.LineBasicMaterial({color:16711680,linewidth:95});this.line=new THREE.Line(p,f);this.current=0},i.prototype.render=function(){var t=50,e=new THREE.Geometry,n=new THREE.QuadraticBezierCurve3;n.v0=new THREE.Vector3(0,0,0),n.v1=new THREE.Vector3(25,25,50),n.v2=new THREE.Vector3(50,50,0),this.current+=.01,this.current>1&&(this.current=0);for(var i=0;i<t;i++){var a=i/t;a<this.current&&e.vertices.push(n.getPoint(a))}this.renderer.render(this.scene,this.camera)},i.prototype.setDataSet=function(t){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=50,e.height=50,n.fillStyle="rgba(255,255,50,0.75)",n.arc(25,25,10,0,2*Math.PI),n.fill();var i=new THREE.Texture(e);i.needsUpdate=!0;var a=new THREE.MeshBasicMaterial({map:i,side:THREE.DoubleSide});a.transparent=!0;for(var o=t.get(),r=o,s=0;s<r.length;s++){var g=r[s];if("Polygon"==g.geometry.type){var h=this.getCoordinates(g.geometry.coordinates[0]);this.addShape(h)}else if("MultiPolygon"==g.geometry.type)for(var c=0;c<g.geometry.coordinates.length;c++){var h=this.getCoordinates(g.geometry.coordinates[c][0]);this.addShape(h)}else if("Point"==g.geometry.type){var l=e.width/15+4*Math.random(),p=new THREE.Mesh(new THREE.PlaneGeometry(l,l),a);p.position.set(g.geometry.coordinates[0]-this.center[0],g.geometry.coordinates[1]-this.center[1],1),this.scene.add(p)}g.name,g.cp}this.scene.add(this.group)},i.prototype.getCoordinates=function(t){for(var e=[],n=0;n<t.length;n++)e.push(new THREE.Vector2(t[n][0]-this.center[0],t[n][1]-this.center[1]));return e},i.prototype.addShape=function(t){var e=new THREE.Shape(t),n=new THREE.ShapeGeometry(e),i="rgb("+~~(256*Math.random())+", "+~~(256*Math.random())+", "+~~(256*Math.random())+")";i=this.intensity.getColor(100*Math.random());var a=new THREE.Mesh(n,new THREE.MeshBasicMaterial({color:i,side:THREE.DoubleSide}));a.position.set(0,0,0),this.group.add(a);var o=e.createPointsGeometry(),r=new THREE.Line(o,new THREE.LineBasicMaterial({color:"rgb(0, 137, 191)",linewidth:1}));r.position.set(0,0,.1),this.group.add(r)};for(var G=[[43.061306,74.477556,40.608989,72.793269]],U=100;U--;)G.push([19.670399+35*Math.random(),78.895343+50*Math.random(),19.670399+35*Math.random(),78.895343+50*Math.random()]);var Z,W,j,V=0,X=G.length,J=[],Y=[],Q=.32,K=[],$=[],tt=!1,et=5,nt=1,it=25;a.prototype.init=function(){var t=this.container.offsetWidth,e=this.container.offsetHeight,n=this.camera=new THREE.PerspectiveCamera(40,t/e,.01,9e3);n.position.z=1;var i=this.scene=new THREE.Scene,a=this.renderer=new THREE.WebGLRenderer({alpha:!0});a.setPixelRatio(window.devicePixelRatio),a.setSize(t,e),this.container.appendChild(a.domElement),i.add(new THREE.AmbientLight(7829367));var r=new THREE.DirectionalLight(16777215,.2);r.position.set(5,3,5),i.add(r);var s=new THREE.DirectionalLight(16777215,.2);s.position.set(5,3,-5),i.add(s);var c,l,p,u=.5,d=64;c=THREE.ImageUtils.loadTexture("images/earth_airports.png",THREE.UVMapping,function(){l=THREE.ImageUtils.loadTexture("images/elevation.jpg",THREE.UVMapping,function(){p=THREE.ImageUtils.loadTexture("images/water.png",THREE.UVMapping,function(){var t=new THREE.Mesh(new THREE.SphereGeometry(u,d,d),new THREE.MeshPhongMaterial({map:c,bumpMap:l,bumpScale:.01,specularMap:p,specular:new THREE.Color("grey")}));t.rotation.y=170*(Math.PI/180),t.rotation.x=30*(Math.PI/180),i.add(t),o(u),W=g(),t.add(W),t.add(h())})})})},a.prototype.render=function(){c(),this.renderer.render(this.scene,this.camera)},a.prototype.setDataSet=function(t){console.log(t.get())},f.prototype.on=function(t,e){var n=this._subscribers[t];n||(n=[],this._subscribers[t]=n),n.push({callback:e})},f.prototype.off=function(t,e){var n=this._subscribers[t];if(n)for(var i=0;i<n.length;i++)n[i].callback==e&&(n.splice(i,1),i--)},f.prototype._trigger=function(t,e,n){if("*"==t)throw new Error("Cannot trigger event *");var i=[];t in this._subscribers&&(i=i.concat(this._subscribers[t])),"*"in this._subscribers&&(i=i.concat(this._subscribers["*"]));for(var a=0,o=i.length;a<o;a++){var r=i[a];r.callback&&r.callback(t,e,n||null)}},v.prototype=new f,v.prototype.add=function(t,e){if(Array.isArray(t))for(var n=0,i=t.length;n<i;n++)this._data.push(t[n]);else{if(!(t instanceof Object))throw new Error("Unknown dataType");this._data.push(t)}},v.prototype.get=function(t){t=t||{};var e=(new Date,this._data);new Date;if(t.filter){for(var n=[],i=0;i<e.length;i++)t.filter(e[i])&&n.push(e[i]);e=n}return t.transferCoordinate&&(e=this.transferCoordinate(e,t.transferCoordinate)),e},v.prototype.set=function(t){this.clear(),this.add(t),this._trigger("change")},v.prototype.clear=function(t){this._data=[]},v.prototype.remove=function(t){},v.prototype.update=function(t){},v.prototype.transferCoordinate=function(t,e){function n(t){for(var n=[],i=0;i<t.length;i++){for(var a=t[i],o=[],r=0;r<a.length;r++)o.push(e(a[r]));n.push(o)}return n}for(var i=0;i<t.length;i++){t[i];if(t[i].geometry){if("Point"===t[i].geometry.type){var a=t[i].geometry.coordinates;t[i].geometry._coordinates=e(a)}if("Polygon"===t[i].geometry.type||"MultiPolygon"===t[i].geometry.type){var a=t[i].geometry.coordinates;if("Polygon"===t[i].geometry.type){var o=n(a);t[i].geometry._coordinates=o}else if("MultiPolygon"===t[i].geometry.type){for(var o=[],r=0;r<a.length;r++){var s=a[r],s=n(s);o.push(s)}t[i].geometry._coordinates=o}}if("LineString"===t[i].geometry.type){for(var a=t[i].geometry.coordinates,o=[],g=0;g<a.length;g++)o.push(e(a[g]));t[i].geometry._coordinates=o}}}return t},v.prototype.initGeometry=function(t){t?this._data.forEach(function(e){e.geometry=t(e)}):this._data.forEach(function(t){!t.geometry&&t.lng&&t.lat&&(t.geometry={type:"Point",coordinates:[t.lng,t.lat]})})};var at={drawDataSet:function(t,e,n){for(var i=e instanceof v?e.get():e,a=0,o=i.length;a<o;a++){var r=i[a];this.draw(t,r,n)}},draw:function(t,e,n){var i=e.geometry.type,a=e.geometry._coordinates||e.geometry.coordinates;n.symbol||"circle";switch(i){case"Point":var o=e._size||e.size||n._size||n.size||5;t.moveTo(e.x,e.y),"rect"===n.symbol?t.rect(a[0],a[1],o,o):t.arc(a[0],a[1],o,0,2*Math.PI);break;case"LineString":for(var r=0;r<a.length;r++){var s=a[r][0],g=a[r][1];0==r?t.moveTo(s,g):t.lineTo(s,g)}break;case"Polygon":this.drawPolygon(t,a);break;case"MultiPolygon":for(var h=0;h<a.length;h++){var c=a[h];this.drawPolygon(t,c)}t.closePath();break;default:console.log("type"+i+"is not support now!")}},drawPolygon:function(t,e){for(var n=0;n<e.length;n++){var i=e[n];t.moveTo(i[0][0],i[0][1]);for(var a=1;a<i.length;a++)t.lineTo(i[a][0],i[a][1]);t.lineTo(i[0][0],i[0][1])}}},ot={draw:function(t,e,n){var i=e instanceof v?e.get():e;t.save();for(var a in n)t[a]=n[a];if(n.bigData){t.save(),t.beginPath();for(var o=0,r=i.length;o<r;o++){var s=i[o];at.draw(t,s,n)}var g=n.bigData;"Point"==g||"Polygon"==g||"MultiPolygon"==g?(t.fill(),(s.strokeStyle||n.strokeStyle)&&t.stroke()):"LineString"==g&&t.stroke(),t.restore()}else for(var o=0,r=i.length;o<r;o++){var s=i[o];t.save(),s.fillStyle&&(t.fillStyle=s.fillStyle),s.strokeStyle&&(t.strokeStyle=s.strokeStyle);var g=s.geometry.type;t.beginPath(),at.draw(t,s,n),"Point"==g||"Polygon"==g||"MultiPolygon"==g?(t.fill(),(s.strokeStyle||n.strokeStyle)&&t.stroke()):"LineString"==g&&t.stroke(),t.restore()}t.restore()}},rt={getImageData:function(t){var e=t.gradient||t.defaultGradient;if("undefined"==typeof document)var n=require("canvas"),i=new n(256,1);else var i=document.createElement("canvas");var a=i.getContext("2d");i.width=256,i.height=1;var o=a.createLinearGradient(0,0,256,1);for(var r in e)o.addColorStop(parseFloat(r),e[r]);return a.fillStyle=o,a.fillRect(0,0,256,1),a.getImageData(0,0,256,1).data}},st={draw:x},gt={draw:function(t,e,i){t.save();for(var a=e.get(),o={},r=i._size||i.size||50,s=i.offset||{x:0,y:0},g=0;g<a.length;g++){var h=a[g].geometry._coordinates||a[g].geometry.coordinates,c=Math.floor((h[0]-s.x)/r)+","+Math.floor((h[1]-s.y)/r);o[c]||(o[c]=0),o[c]+=~~(a[g].count||1)}for(var c in o){c=c.split(",");var l=new n({max:i.max||100,gradient:i.gradient});t.beginPath(),t.rect(c[0]*r+.5+s.x,c[1]*r+.5+s.y,r-1,r-1),t.fillStyle=l.getColor(o[c]),t.fill(),i.showText&&(t.fillStyle="white",t.fillText(o[c],c[0]*r+.5+s.x+r/2-1,c[1]*r+.5+s.y+r/2-1)),(i.strokeStyle||i.lineWidth)&&t.stroke()}t.restore()}},ht={draw:function(t,e,i){t.save();var a=e.get();for(var o in i)t[o]=i[o];var r=i.offset||{x:10,y:10},s=i._size||i.size||40;s=s/2/Math.sin(Math.PI/3);for(var g=2*s*Math.sin(Math.PI/3),h=1.5*s,c={},l=0;l<a.length;l++){var p=a[l].geometry._coordinates||a[l].geometry.coordinates,u=(p[1]-r.y)/h,d=Math.round(u),f=(p[0]-r.x)/g-(1&d?.5:0),v=Math.round(f),m=u-d;if(3*Math.abs(m)>1){var y=f-v,w=v+(f<v?-1:1)/2,x=d+(u<d?-1:1),_=f-w,M=u-x;y*y+m*m>_*_+M*M&&(v=w+(1&d?1:-1)/2,d=x)}var b=v+"-"+d,S=c[b];S?S.push(a[l]):(S=c[b]=[a[l]],S.i=v,S.j=d,S.x=(v+(1&d?.5:0))*g,S.y=d*h)}var R=new n({max:i.max||100,maxSize:s,gradient:i.gradient});for(var o in c){var P=c[o];t.beginPath();for(var C=0;C<6;C++){var T=s,z=E({x:P.x+r.x,y:P.y+r.y},T,C);t.lineTo(z[0],z[1])}t.closePath();for(var L=0,l=0;l<P.length;l++)L+=P[l].count||1;t.fillStyle=R.getColor(L),t.fill(),(i.strokeStyle||i.lineWidth)&&t.stroke()}t.restore()}},ct={municipalities:[{n:"北京",g:"116.395645,39.929986|12"},{n:"上海",g:"121.487899,31.249162|12"},{n:"天津",g:"117.210813,39.14393|12"},{n:"重庆",g:"106.530635,29.544606|12"}],provinces:[{n:"安徽",g:"117.216005,31.859252|8",cities:[{n:"合肥",g:"117.282699,31.866942|12"},{n:"安庆",g:"117.058739,30.537898|13"},{n:"蚌埠",g:"117.35708,32.929499|13"},{n:"亳州",g:"115.787928,33.871211|13"},{n:"巢湖",g:"117.88049,31.608733|13"},{n:"池州",g:"117.494477,30.660019|14"},{n:"滁州",g:"118.32457,32.317351|13"},{n:"阜阳",g:"115.820932,32.901211|13"},{n:"淮北",g:"116.791447,33.960023|13"},{n:"淮南",g:"117.018639,32.642812|13"},{n:"黄山",g:"118.29357,29.734435|13"},{n:"六安",g:"116.505253,31.755558|13"},{n:"马鞍山",g:"118.515882,31.688528|13"},{n:"宿州",g:"116.988692,33.636772|13"},{n:"铜陵",g:"117.819429,30.94093|14"},{n:"芜湖",g:"118.384108,31.36602|12"},{n:"宣城",g:"118.752096,30.951642|13"}]},{n:"福建",g:"117.984943,26.050118|8",cities:[{n:"福州",g:"119.330221,26.047125|12"},{n:"龙岩",g:"117.017997,25.078685|13"},{n:"南平",g:"118.181883,26.643626|13"},{n:"宁德",g:"119.542082,26.656527|14"},{n:"莆田",g:"119.077731,25.44845|13"},{n:"泉州",g:"118.600362,24.901652|12"},{n:"三明",g:"117.642194,26.270835|14"},{n:"厦门",g:"118.103886,24.489231|12"},{n:"漳州",g:"117.676205,24.517065|12"}]},{n:"甘肃",g:"102.457625,38.103267|6",cities:[{n:"兰州",g:"103.823305,36.064226|12"},{n:"白银",g:"104.171241,36.546682|13"},{n:"定西",g:"104.626638,35.586056|13"},{n:"甘南州",g:"102.917442,34.992211|14"},{n:"嘉峪关",g:"98.281635,39.802397|13"},{n:"金昌",g:"102.208126,38.516072|13"},{n:"酒泉",g:"98.508415,39.741474|13"},{n:"临夏州",g:"103.215249,35.598514|13"},{n:"陇南",g:"104.934573,33.39448|14"},{n:"平凉",g:"106.688911,35.55011|13"},{n:"庆阳",g:"107.644227,35.726801|13"},{n:"天水",g:"105.736932,34.584319|13"},{n:"武威",g:"102.640147,37.933172|13"},{n:"张掖",g:"100.459892,38.93932|13"}]},{n:"广东",g:"113.394818,23.408004|8",cities:[{n:"广州",g:"113.30765,23.120049|12"},{n:"潮州",g:"116.630076,23.661812|13"},{n:"东莞",g:"113.763434,23.043024|12"},{n:"佛山",g:"113.134026,23.035095|13"},{n:"河源",g:"114.713721,23.757251|12"},{n:"惠州",g:"114.410658,23.11354|12"},{n:"江门",g:"113.078125,22.575117|13"},{n:"揭阳",g:"116.379501,23.547999|13"
},{n:"茂名",g:"110.931245,21.668226|13"},{n:"梅州",g:"116.126403,24.304571|13"},{n:"清远",g:"113.040773,23.698469|13"},{n:"汕头",g:"116.72865,23.383908|13"},{n:"汕尾",g:"115.372924,22.778731|14"},{n:"韶关",g:"113.594461,24.80296|13"},{n:"深圳",g:"114.025974,22.546054|12"},{n:"阳江",g:"111.97701,21.871517|14"},{n:"云浮",g:"112.050946,22.937976|13"},{n:"湛江",g:"110.365067,21.257463|13"},{n:"肇庆",g:"112.479653,23.078663|13"},{n:"中山",g:"113.42206,22.545178|12"},{n:"珠海",g:"113.562447,22.256915|13"}]},{n:"广西",g:"108.924274,23.552255|7",cities:[{n:"南宁",g:"108.297234,22.806493|12"},{n:"百色",g:"106.631821,23.901512|13"},{n:"北海",g:"109.122628,21.472718|13"},{n:"崇左",g:"107.357322,22.415455|14"},{n:"防城港",g:"108.351791,21.617398|15"},{n:"桂林",g:"110.26092,25.262901|12"},{n:"贵港",g:"109.613708,23.103373|13"},{n:"河池",g:"108.069948,24.699521|14"},{n:"贺州",g:"111.552594,24.411054|14"},{n:"来宾",g:"109.231817,23.741166|14"},{n:"柳州",g:"109.422402,24.329053|12"},{n:"钦州",g:"108.638798,21.97335|13"},{n:"梧州",g:"111.305472,23.485395|13"},{n:"玉林",g:"110.151676,22.643974|14"}]},{n:"贵州",g:"106.734996,26.902826|8",cities:[{n:"贵阳",g:"106.709177,26.629907|12"},{n:"安顺",g:"105.92827,26.228595|13"},{n:"毕节地区",g:"105.300492,27.302612|14"},{n:"六盘水",g:"104.852087,26.591866|13"},{n:"铜仁地区",g:"109.196161,27.726271|14"},{n:"遵义",g:"106.93126,27.699961|13"},{n:"黔西南州",g:"104.900558,25.095148|11"},{n:"黔东南州",g:"107.985353,26.583992|11"},{n:"黔南州",g:"107.523205,26.264536|11"}]},{n:"海南",g:"109.733755,19.180501|9",cities:[{n:"海口",g:"110.330802,20.022071|13"},{n:"白沙",g:"109.358586,19.216056|12"},{n:"保亭",g:"109.656113,18.597592|12"},{n:"昌江",g:"109.0113,19.222483|12"},{n:"儋州",g:"109.413973,19.571153|13"},{n:"澄迈",g:"109.996736,19.693135|13"},{n:"东方",g:"108.85101,18.998161|13"},{n:"定安",g:"110.32009,19.490991|13"},{n:"琼海",g:"110.414359,19.21483|13"},{n:"琼中",g:"109.861849,19.039771|12"},{n:"乐东",g:"109.062698,18.658614|12"},{n:"临高",g:"109.724101,19.805922|13"},{n:"陵水",g:"109.948661,18.575985|12"},{n:"三亚",g:"109.522771,18.257776|12"},{n:"屯昌",g:"110.063364,19.347749|13"},{n:"万宁",g:"110.292505,18.839886|13"},{n:"文昌",g:"110.780909,19.750947|13"},{n:"五指山",g:"109.51775,18.831306|13"}]},{n:"河北",g:"115.661434,38.61384|7",cities:[{n:"石家庄",g:"114.522082,38.048958|12"},{n:"保定",g:"115.49481,38.886565|13"},{n:"沧州",g:"116.863806,38.297615|13"},{n:"承德",g:"117.933822,40.992521|14"},{n:"邯郸",g:"114.482694,36.609308|13"},{n:"衡水",g:"115.686229,37.746929|13"},{n:"廊坊",g:"116.703602,39.518611|13"},{n:"秦皇岛",g:"119.604368,39.945462|12"},{n:"唐山",g:"118.183451,39.650531|13"},{n:"邢台",g:"114.520487,37.069531|13"},{n:"张家口",g:"114.893782,40.811188|13"}]},{n:"河南",g:"113.486804,34.157184|7",cities:[{n:"郑州",g:"113.649644,34.75661|12"},{n:"安阳",g:"114.351807,36.110267|12"},{n:"鹤壁",g:"114.29777,35.755426|13"},{n:"焦作",g:"113.211836,35.234608|13"},{n:"开封",g:"114.351642,34.801854|13"},{n:"洛阳",g:"112.447525,34.657368|12"},{n:"漯河",g:"114.046061,33.576279|13"},{n:"南阳",g:"112.542842,33.01142|13"},{n:"平顶山",g:"113.300849,33.745301|13"},{n:"濮阳",g:"115.026627,35.753298|12"},{n:"三门峡",g:"111.181262,34.78332|13"},{n:"商丘",g:"115.641886,34.438589|13"},{n:"新乡",g:"113.91269,35.307258|13"},{n:"信阳",g:"114.085491,32.128582|13"},{n:"许昌",g:"113.835312,34.02674|13"},{n:"周口",g:"114.654102,33.623741|13"},{n:"驻马店",g:"114.049154,32.983158|13"}]},{n:"黑龙江",g:"128.047414,47.356592|6",cities:[{n:"哈尔滨",g:"126.657717,45.773225|12"},{n:"大庆",g:"125.02184,46.596709|12"},{n:"大兴安岭地区",g:"124.196104,51.991789|10"},{n:"鹤岗",g:"130.292472,47.338666|13"},{n:"黑河",g:"127.50083,50.25069|14"},{n:"鸡西",g:"130.941767,45.32154|13"},{n:"佳木斯",g:"130.284735,46.81378|12"},{n:"牡丹江",g:"129.608035,44.588521|13"},{n:"七台河",g:"131.019048,45.775005|14"},{n:"齐齐哈尔",g:"123.987289,47.3477|13"},{n:"双鸭山",g:"131.171402,46.655102|13"},{n:"绥化",g:"126.989095,46.646064|13"},{n:"伊春",g:"128.910766,47.734685|14"}]},{n:"湖北",g:"112.410562,31.209316|8",cities:[{n:"武汉",g:"114.3162,30.581084|12"},{n:"鄂州",g:"114.895594,30.384439|14"},{n:"恩施",g:"109.517433,30.308978|14"},{n:"黄冈",g:"114.906618,30.446109|14"},{n:"黄石",g:"115.050683,30.216127|13"},{n:"荆门",g:"112.21733,31.042611|13"},{n:"荆州",g:"112.241866,30.332591|12"},{n:"潜江",g:"112.768768,30.343116|13"},{n:"神农架林区",g:"110.487231,31.595768|13"},{n:"十堰",g:"110.801229,32.636994|13"},{n:"随州",g:"113.379358,31.717858|13"},{n:"天门",g:"113.12623,30.649047|13"},{n:"仙桃",g:"113.387448,30.293966|13"},{n:"咸宁",g:"114.300061,29.880657|13"},{n:"襄阳",g:"112.176326,32.094934|12"},{n:"孝感",g:"113.935734,30.927955|13"},{n:"宜昌",g:"111.310981,30.732758|13"}]},{n:"湖南",g:"111.720664,27.695864|7",cities:[{n:"长沙",g:"112.979353,28.213478|12"},{n:"常德",g:"111.653718,29.012149|12"},{n:"郴州",g:"113.037704,25.782264|13"},{n:"衡阳",g:"112.583819,26.898164|13"},{n:"怀化",g:"109.986959,27.557483|13"},{n:"娄底",g:"111.996396,27.741073|13"},{n:"邵阳",g:"111.461525,27.236811|13"},{n:"湘潭",g:"112.935556,27.835095|13"},{n:"湘西州",g:"109.745746,28.317951|14"},{n:"益阳",g:"112.366547,28.588088|13"},{n:"永州",g:"111.614648,26.435972|13"},{n:"岳阳",g:"113.146196,29.378007|13"},{n:"张家界",g:"110.48162,29.124889|13"},{n:"株洲",g:"113.131695,27.827433|13"}]},{n:"江苏",g:"119.368489,33.013797|8",cities:[{n:"南京",g:"118.778074,32.057236|12"},{n:"常州",g:"119.981861,31.771397|12"},{n:"淮安",g:"119.030186,33.606513|12"},{n:"连云港",g:"119.173872,34.601549|12"},{n:"南通",g:"120.873801,32.014665|12"},{n:"苏州",g:"120.619907,31.317987|12"},{n:"宿迁",g:"118.296893,33.95205|13"},{n:"泰州",g:"119.919606,32.476053|13"},{n:"无锡",g:"120.305456,31.570037|12"},{n:"徐州",g:"117.188107,34.271553|12"},{n:"盐城",g:"120.148872,33.379862|12"},{n:"扬州",g:"119.427778,32.408505|13"},{n:"镇江",g:"119.455835,32.204409|13"}]},{n:"江西",g:"115.676082,27.757258|7",cities:[{n:"南昌",g:"115.893528,28.689578|12"},{n:"抚州",g:"116.360919,27.954545|13"},{n:"赣州",g:"114.935909,25.845296|13"},{n:"吉安",g:"114.992039,27.113848|13"},{n:"景德镇",g:"117.186523,29.303563|12"},{n:"九江",g:"115.999848,29.71964|13"},{n:"萍乡",g:"113.859917,27.639544|13"},{n:"上饶",g:"117.955464,28.457623|13"},{n:"新余",g:"114.947117,27.822322|13"},{n:"宜春",g:"114.400039,27.81113|13"},{n:"鹰潭",g:"117.03545,28.24131|13"}]},{n:"吉林",g:"126.262876,43.678846|7",cities:[{n:"长春",g:"125.313642,43.898338|12"},{n:"白城",g:"122.840777,45.621086|13"},{n:"白山",g:"126.435798,41.945859|13"},{n:"吉林市",g:"126.564544,43.871988|12"},{n:"辽源",g:"125.133686,42.923303|13"},{n:"四平",g:"124.391382,43.175525|12"},{n:"松原",g:"124.832995,45.136049|13"},{n:"通化",g:"125.94265,41.736397|13"},{n:"延边",g:"129.485902,42.896414|13"}]},{n:"辽宁",g:"122.753592,41.6216|8",cities:[{n:"沈阳",g:"123.432791,41.808645|12"},{n:"鞍山",g:"123.007763,41.118744|13"},{n:"本溪",g:"123.778062,41.325838|12"},{n:"朝阳",g:"120.446163,41.571828|13"},{n:"大连",g:"121.593478,38.94871|12"},{n:"丹东",g:"124.338543,40.129023|12"},{n:"抚顺",g:"123.92982,41.877304|12"},{n:"阜新",g:"121.660822,42.01925|14"},{n:"葫芦岛",g:"120.860758,40.74303|13"},{n:"锦州",g:"121.147749,41.130879|13"},{n:"辽阳",g:"123.172451,41.273339|14"},{n:"盘锦",g:"122.073228,41.141248|13"},{n:"铁岭",g:"123.85485,42.299757|13"},{n:"营口",g:"122.233391,40.668651|13"}]},{n:"内蒙古",g:"114.415868,43.468238|5",cities:[{n:"呼和浩特",g:"111.660351,40.828319|12"},{n:"阿拉善盟",g:"105.695683,38.843075|14"},{n:"包头",g:"109.846239,40.647119|12"},{n:"巴彦淖尔",g:"107.423807,40.76918|12"},{n:"赤峰",g:"118.930761,42.297112|12"},{n:"鄂尔多斯",g:"109.993706,39.81649|12"},{n:"呼伦贝尔",g:"119.760822,49.201636|12"},{n:"通辽",g:"122.260363,43.633756|12"},{n:"乌海",g:"106.831999,39.683177|13"},{n:"乌兰察布",g:"113.112846,41.022363|12"},{n:"锡林郭勒盟",g:"116.02734,43.939705|11"},{n:"兴安盟",g:"122.048167,46.083757|11"}]},{n:"宁夏",g:"106.155481,37.321323|8",cities:[{n:"银川",g:"106.206479,38.502621|12"},{n:"固原",g:"106.285268,36.021523|13"},{n:"石嘴山",g:"106.379337,39.020223|13"},{n:"吴忠",g:"106.208254,37.993561|14"},{n:"中卫",g:"105.196754,37.521124|14"}]},{n:"青海",g:"96.202544,35.499761|7",cities:[{n:"西宁",g:"101.767921,36.640739|12"},{n:"果洛州",g:"100.223723,34.480485|11"},{n:"海东地区",g:"102.085207,36.51761|11"},{n:"海北州",g:"100.879802,36.960654|11"},{n:"海南州",g:"100.624066,36.284364|11"},{n:"海西州",g:"97.342625,37.373799|11"},{n:"黄南州",g:"102.0076,35.522852|11"},{n:"玉树州",g:"97.013316,33.00624|14"}]},{n:"山东",g:"118.527663,36.09929|8",cities:[{n:"济南",g:"117.024967,36.682785|12"},{n:"滨州",g:"117.968292,37.405314|12"},{n:"东营",g:"118.583926,37.487121|12"},{n:"德州",g:"116.328161,37.460826|12"},{n:"菏泽",g:"115.46336,35.26244|13"},{n:"济宁",g:"116.600798,35.402122|13"},{n:"莱芜",g:"117.684667,36.233654|13"},{n:"聊城",g:"115.986869,36.455829|12"},{n:"临沂",g:"118.340768,35.072409|12"},{n:"青岛",g:"120.384428,36.105215|12"},{n:"日照",g:"119.50718,35.420225|12"},{n:"泰安",g:"117.089415,36.188078|13"},{n:"威海",g:"122.093958,37.528787|13"},{n:"潍坊",g:"119.142634,36.716115|12"},{n:"烟台",g:"121.309555,37.536562|12"},{n:"枣庄",g:"117.279305,34.807883|13"},{n:"淄博",g:"118.059134,36.804685|12"}]},{n:"山西",g:"112.515496,37.866566|7",cities:[{n:"太原",g:"112.550864,37.890277|12"},{n:"长治",g:"113.120292,36.201664|12"},{n:"大同",g:"113.290509,40.113744|12"},{n:"晋城",g:"112.867333,35.499834|13"},{n:"晋中",g:"112.738514,37.693362|13"},{n:"临汾",g:"111.538788,36.099745|13"},{n:"吕梁",g:"111.143157,37.527316|14"},{n:"朔州",g:"112.479928,39.337672|13"},{n:"忻州",g:"112.727939,38.461031|12"},{n:"阳泉",g:"113.569238,37.869529|13"},{n:"运城",g:"111.006854,35.038859|13"}]},{n:"陕西",g:"109.503789,35.860026|7",cities:[{n:"西安",g:"108.953098,34.2778|12"},{n:"安康",g:"109.038045,32.70437|13"},{n:"宝鸡",g:"107.170645,34.364081|12"},{n:"汉中",g:"107.045478,33.081569|13"},{n:"商洛",g:"109.934208,33.873907|13"},{n:"铜川",g:"108.968067,34.908368|13"},{n:"渭南",g:"109.483933,34.502358|13"},{n:"咸阳",g:"108.707509,34.345373|13"},{n:"延安",g:"109.50051,36.60332|13"},{n:"榆林",g:"109.745926,38.279439|12"}]},{n:"四川",g:"102.89916,30.367481|7",cities:[{n:"成都",g:"104.067923,30.679943|12"},{n:"阿坝州",g:"102.228565,31.905763|15"},{n:"巴中",g:"106.757916,31.869189|14"},{n:"达州",g:"107.494973,31.214199|14"},{n:"德阳",g:"104.402398,31.13114|13"},{n:"甘孜州",g:"101.969232,30.055144|15"},{n:"广安",g:"106.63572,30.463984|13"},{n:"广元",g:"105.819687,32.44104|13"},{n:"乐山",g:"103.760824,29.600958|13"},{n:"凉山州",g:"102.259591,27.892393|14"},{n:"泸州",g:"105.44397,28.89593|14"},{n:"南充",g:"106.105554,30.800965|13"},{n:"眉山",g:"103.84143,30.061115|13"},{n:"绵阳",g:"104.705519,31.504701|12"},{n:"内江",g:"105.073056,29.599462|13"},{n:"攀枝花",g:"101.722423,26.587571|14"},{n:"遂宁",g:"105.564888,30.557491|12"},{n:"雅安",g:"103.009356,29.999716|13"},{n:"宜宾",g:"104.633019,28.769675|13"},{n:"资阳",g:"104.63593,30.132191|13"},{n:"自贡",g:"104.776071,29.359157|13"}]},{n:"西藏",g:"89.137982,31.367315|6",cities:[{n:"拉萨",g:"91.111891,29.662557|13"},{n:"阿里地区",g:"81.107669,30.404557|11"},{n:"昌都地区",g:"97.185582,31.140576|15"},{n:"林芝地区",g:"94.349985,29.666941|11"},{n:"那曲地区",g:"92.067018,31.48068|14"},{n:"日喀则地区",g:"88.891486,29.269023|14"},{n:"山南地区",g:"91.750644,29.229027|11"}]},{n:"新疆",g:"85.614899,42.127001|6",cities:[{n:"乌鲁木齐",g:"87.564988,43.84038|12"},{n:"阿拉尔",g:"81.291737,40.61568|13"},{n:"阿克苏地区",g:"80.269846,41.171731|12"},{n:"阿勒泰地区",g:"88.137915,47.839744|13"},{n:"巴音郭楞",g:"86.121688,41.771362|12"},{n:"博尔塔拉州",g:"82.052436,44.913651|11"},{n:"昌吉州",g:"87.296038,44.007058|13"},{n:"哈密地区",g:"93.528355,42.858596|13"},{n:"和田地区",g:"79.930239,37.116774|13"},{n:"喀什地区",g:"75.992973,39.470627|12"},{n:"克拉玛依",g:"84.88118,45.594331|13"},{n:"克孜勒苏州",g:"76.137564,39.750346|11"},{n:"石河子",g:"86.041865,44.308259|13"},{n:"塔城地区",g:"82.974881,46.758684|12"},{n:"图木舒克",g:"79.198155,39.889223|13"},{n:"吐鲁番地区",g:"89.181595,42.96047|13"},{n:"五家渠",g:"87.565449,44.368899|13"},{n:"伊犁州",g:"81.297854,43.922248|11"}]},{n:"云南",g:"101.592952,24.864213|7",cities:[{n:"昆明",g:"102.714601,25.049153|12"},{n:"保山",g:"99.177996,25.120489|13"},{n:"楚雄州",g:"101.529382,25.066356|13"},{n:"大理州",g:"100.223675,25.5969|14"},{n:"德宏州",g:"98.589434,24.44124|14"},{n:"迪庆州",g:"99.713682,27.831029|14"},{n:"红河州",g:"103.384065,23.367718|11"},{n:"丽江",g:"100.229628,26.875351|13"},{n:"临沧",g:"100.092613,23.887806|14"},{n:"怒江州",g:"98.859932,25.860677|14"},{n:"普洱",g:"100.980058,22.788778|14"},{n:"曲靖",g:"103.782539,25.520758|12"},{n:"昭通",g:"103.725021,27.340633|13"},{n:"文山",g:"104.089112,23.401781|14"},{n:"西双版纳",g:"100.803038,22.009433|13"},{n:"玉溪",g:"102.545068,24.370447|13"}]},{n:"浙江",g:"119.957202,29.159494|8",cities:[{n:"杭州",g:"120.219375,30.259244|12"},{n:"湖州",g:"120.137243,30.877925|12"},{n:"嘉兴",g:"120.760428,30.773992|13"},{n:"金华",g:"119.652576,29.102899|12"},{n:"丽水",g:"119.929576,28.4563|13"},{n:"宁波",g:"121.579006,29.885259|12"},{n:"衢州",g:"118.875842,28.95691|12"},{n:"绍兴",g:"120.592467,30.002365|13"},{n:"台州",g:"121.440613,28.668283|13"},{n:"温州",g:"120.690635,28.002838|12"},{n:"舟山",g:"122.169872,30.03601|13"}]}],other:[{n:"香港",g:"114.186124,22.293586|11"},{n:"澳门",g:"113.557519,22.204118|13"},{n:"台湾",g:"120.961454,23.80406|8"}]},lt={getCenterByCityName:function(t){for(var e=0;e<ct.municipalities.length;e++)if(ct.municipalities[e].n==t)return _(ct.municipalities[e].g);for(var n=ct.provinces,e=0;e<n.length;e++){if(n[e].n==t)return _(n[e].g);for(var i=n[e].cities,a=0;a<i.length;a++)if(i[a].n==t)return _(i[a].g)}return null}},pt={getPoints:M},ut=function(){function t(t,e){return t.x*e.x+t.y*e.y}function e(t){return{x:M[t.target].x-M[t.source].x,y:M[t.target].y-M[t.source].y}}function n(t){return Math.sqrt(Math.pow(M[t.source].x-M[t.target].x,2)+Math.pow(M[t.source].y-M[t.target].y,2))}function i(t){return Math.sqrt(Math.pow(t.source.x-t.target.x,2)+Math.pow(t.source.y-t.target.y,2))}function a(t){var e=(M[t.source].x+M[t.target].x)/2,n=(M[t.source].y+M[t.target].y)/2;return{x:e,y:n}}function o(t){for(var e=0,n=1;n<R[t].length;n++){var i=r(R[t][n],R[t][n-1]);e+=i}return e}function r(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function s(t,e){var n=Math.sqrt((e.target.x-e.source.x)*(e.target.x-e.source.x)+(e.target.y-e.source.y)*(e.target.y-e.source.y)),i=((e.source.y-t.y)*(e.source.y-e.target.y)-(e.source.x-t.x)*(e.target.x-e.source.x))/(n*n);return{x:e.source.x+i*(e.target.x-e.source.x),y:e.source.y+i*(e.target.y-e.source.y)}}function g(){for(var t=0;t<b.length;t++)1==z?R[t]=[]:(R[t]=[],R[t].push(M[b[t].source]),R[t].push(M[b[t].target]))}function h(){for(var t=0;t<b.length;t++)S[t]=[]}function c(t){for(var e=[],n=0;n<t.length;n++)M[t[n].source].x!=M[t[n].target].x&&M[t[n].source].y!=M[t[n].target].y&&e.push(t[n]);return e}function l(t,e,n){var i=R[t][e-1],a=R[t][e+1],o=R[t][e],r=i.x-o.x+a.x-o.x,s=i.y-o.y+a.y-o.y;return r*=n,s*=n,{x:r,y:s}}function p(t,e,n){for(var a={x:0,y:0},o=S[t],r=0;r<o.length;r++){var s={x:R[o[r]][e].x-R[t][e].x,y:R[o[r]][e].y-R[t][e].y};if(Math.abs(s.x)>F||Math.abs(s.y)>F){var g=1/Math.pow(i({source:R[o[r]][e],target:R[t][e]}),1);a.x+=s.x*g,a.y+=s.y*g}}return a}function u(t,e,i){for(var a=C/(n(b[t])*(e+1)),o=[{x:0,y:0}],r=1;r<e+1;r++){var s={x:0,y:0},g=l(t,r,a),h=p(t,r,i);s.x=i*(g.x+h.x),s.y=i*(g.y+h.y),o.push(s)}return o.push({x:0,y:0}),o}function d(t){for(var e=0;e<b.length;e++)if(1==t)R[e].push(M[b[e].source]),R[e].push(a(b[e])),R[e].push(M[b[e].target]);else{var n=o(e),i=n/(t+1),s=i,g=[];g.push(M[b[e].source]);for(var h=1;h<R[e].length;h++){for(var c=r(R[e][h],R[e][h-1]);c>s;){var l=s/c,p=R[e][h-1].x,u=R[e][h-1].y;p+=l*(R[e][h].x-R[e][h-1].x),u+=l*(R[e][h].y-R[e][h-1].y),g.push({x:p,y:u}),c-=s,s=i}s-=c}g.push(M[b[e].target]),R[e]=g}}function f(i,a){var o=Math.abs(t(e(i),e(a))/(n(i)*n(a)));return o}function v(t,e){var i=(n(t)+n(e))/2,a=2/(i/Math.min(n(t),n(e))+Math.max(n(t),n(e))/i);return a}function m(t,e){var i=(n(t)+n(e))/2,a={x:(M[t.source].x+M[t.target].x)/2,y:(M[t.source].y+M[t.target].y)/2},o={x:(M[e.source].x+M[e.target].x)/2,y:(M[e.source].y+M[e.target].y)/2},s=i/(i+r(a,o));return s}function y(t,e){var n=s(M[e.source],{source:M[t.source],target:M[t.target]}),i=s(M[e.target],{source:M[t.source],target:M[t.target]}),a={x:(n.x+i.x)/2,y:(n.y+i.y)/2},o={x:(M[t.source].x+M[t.target].x)/2,y:(M[t.source].y+M[t.target].y)/2},g=Math.max(0,1-2*r(o,a)/r(n,i));return g}function w(t,e){return Math.min(y(t,e),y(e,t))}function x(t,e){var n=f(t,e)*v(t,e)*m(t,e)*w(t,e);return n}function E(t,e){return x(t,e)>=I}function _(){for(var t=0;t<b.length-1;t++)for(var e=t+1;e<b.length;e++)t!=e&&E(b[t],b[e])&&(S[t].push(e),S[e].push(t))}var M={},b=[],S=[],R=[],C=.1,T=.1,z=1,L=2,H=6,k=70,A=.6666667,I=.6,F=1e-8,D=function(){var t=T,e=k,n=z;g(),h(),d(n),_();for(var i=0;i<H;i++){for(var a=0;a<e;a++){for(var o=[],r=0;r<b.length;r++)o[r]=u(r,n,t);for(var s=0;s<b.length;s++)for(var c=0;c<n+1;c++)R[s][c].x+=o[s][c].x,R[s][c].y+=o[s][c].y}t/=2,n*=2,e*=A,d(n)}return R};return D.nodes=function(t){return 0==arguments.length?M:(M=t,D)},D.edges=function(t){return 0==arguments.length?b:(b=c(t),D)},D.bundling_stiffness=function(t){return 0==arguments.length?C:(C=t,D)},D.step_size=function(t){return 0==arguments.length?T:(T=t,D)},D.cycles=function(t){return 0==arguments.length?H:(H=t,D)},D.iterations=function(t){return 0==arguments.length?k:(k=t,D)},D.iterations_rate=function(t){return 0==arguments.length?A:(A=t,D)},D.subdivision_points_seed=function(t){return 0==arguments.length?P:(P=t,D)},D.subdivision_rate=function(t){return 0==arguments.length?L:(L=t,D)},D.compatbility_threshold=function(t){return 0==arguments.length?compatbility_threshold:(I=t,D)},D};S.prototype.get=function(t){var e=this.splitList,n=e.other;for(var i in e)if(t==i){n=e[i];break}return n},R.prototype.get=function(t){for(var e=this.splitList,n=!1,i=0;i<e.length;i++)if((void 0===e[i].start||void 0!==e[i].start&&t>=e[i].start)&&(void 0===e[i].end||void 0!==e[i].end&&t<e[i].end)){n=e[i].value;break}return n};var dt=function(){function t(e,n){q(this,t),this._call=e,this._runing=!1,this.start()}return N(t,[{key:"start",value:function(){this._runing=!0,requestAnimationFrame(this._launch.bind(this))}},{key:"stop",value:function(){this._runing=!1}},{key:"_launch",value:function(t){this._runing&&(this._call&&this._call(t),requestAnimationFrame(this._launch.bind(this)))}}]),t}(),ft=function(t,e){if(t<0)throw new Error("start must be a positive number");if(t>=e)throw new Error("start must be smaller than end");this.start=t,this.end=e};ft.prototype={diff:function(){return this.end-this.start},isLast:function(t){return(0|t)===this.end}};var vt="undefined"==typeof window?{}:window,mt=vt.requestAnimationFrame||vt.mozRequestAnimationFrame||vt.webkitRequestAnimationFrame||vt.msRequestAnimationFrame||function(t){return vt.setTimeout(t,1e3/60)},yt=vt.cancelAnimationFrame||vt.mozCancelAnimationFrame||vt.webkitCancelAnimationFrame||vt.msCancelAnimationFrame||function(t){clearTimeout(t)};L.prototype={start:function(){this.running=!0,mt(this._tick),this.options.onStart&&this.options.onStart(),1===this.stepsRange().diff()&&(this.running=!1)},isRunning:function(){return this.running},stop:function(){this.pause(),this.time(this.stepsRange().start),this.options.onStop&&this.options.onStop()},time:function(t){if(!arguments.length)return this._time;this._time=t;var e=this.range(this.domain(this._time));this.callback(e)},toggle:function(){this.running?this.pause():this.start()},rescale:function(){return this.domainInv=z(this.options.animationDelay,this.options.animationDelay+this.options.animationDuration),this.domain=this.domainInv.invert(),this.range=z(0,this._defaultStepsRange.end),this.rangeInv=this.range.invert(),this.time(this._time),this.running?this.start():this.pause(),this},duration:function(t){return arguments.length?(this.options.animationDuration=t,this.time()>t&&this.time(0),this.rescale(),this):this.options.animationDuration},steps:function(t){return this.options.steps=t,this._defaultStepsRange=new ft(0,t),this.rescale()},stepsRange:function(t,e){if(2===arguments.length){if(t<this._defaultStepsRange.start)throw new Error("start must be within default steps range");if(e>this._defaultStepsRange.end)throw new Error("end must be within default steps range");this._customStepsRange=new ft(t,e),this.options.onStepsRange&&this.options.onStepsRange();var n=0|this.step();(n<t||n>e)&&this.step(t)}return this._customStepsRange||this._defaultStepsRange},removeCustomStepsRange:function(){this._customStepsRange=void 0,this.options.onStepsRange&&this.options.onStepsRange()},step:function(t){return 0===arguments.length?this.range(this.domain(this._time)):void(this._time=this.domainInv(this.rangeInv(t)))},pause:function(){this.running=!1,yt(this._tick),this.options.onPause&&this.options.onPause()},_tick:function(){var t=+new Date,e=.001*(t-this._t0);e=Math.min(this.options.maxDelta,e),this._t0=t,this._time+=e;var n=this.stepsRange();n.isLast(this.step())&&(this.options.loop?this.step(n.start):(this.time(this.options.animationDuration),this.pause())),this.running&&(this.time(this._time),mt(this._tick))}};var wt=function(){function t(e,n,i){if(q(this,t),!e||!n)return console.warn("id 和 type 为必填项"),!1;if("baidu"==n){if(!BMap)return console.warn("请先引入百度地图JS API"),!1}else console.warn("暂不支持你的地图类型");this.type=n;var a=i&&i.center?i.center:[106.962497,38.208726],o=i&&i.zoom?i.zoom:5,r=this.map=new BMap.Map(e,{enableMapClick:!1});r.centerAndZoom(new BMap.Point(a[0],a[1]),o),r.enableScrollWheelZoom(!0),r.setMapStyle({style:"light"})}return N(t,[{key:"addLayer",value:function(t,e){if("baidu"==this.type)return new mapv.baiduMapLayer(this.map,dataSet,e)}},{key:"getMap",value:function(){return this.map}}]),t}(),xt="undefined"==typeof window?{}:window;xt.BMap&&(H.prototype=new BMap.Overlay,H.prototype.initialize=function(t){this._map=t;var e=this.canvas=document.createElement("canvas");e.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";",e.style.mixBlendMode=this.mixBlendMode,this.adjustSize(),t.getPanes()[this.paneName].appendChild(e);var n=this;return t.addEventListener("resize",function(){n.adjustSize(),n._draw()}),this.canvas},H.prototype.adjustSize=function(){var t=this._map.getSize(),e=this.canvas,n=this.devicePixelRatio=xt.devicePixelRatio;e.width=t.width*n,e.height=t.height*n,e.getContext("2d").scale(n,n),e.style.width=t.width+"px",e.style.height=t.height+"px"},H.prototype.draw=function(){var t=this;clearTimeout(t.timeoutID),t.timeoutID=setTimeout(function(){t._draw()},15)},H.prototype._draw=function(){var t=this._map,e=t.getSize(),n=t.getCenter();if(n){var i=t.pointToOverlayPixel(n);this.canvas.style.left=i.x-e.width/2+"px",this.canvas.style.top=i.y-e.height/2+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.call(this)}},H.prototype.getContainer=function(){return this.canvas},H.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},H.prototype.hide=function(){this.canvas.style.display="none"},H.prototype.setZIndex=function(t){this.canvas.style.zIndex=t},H.prototype.getZIndex=function(){return this.zIndex});var Et={draw:function(t,e,n){var i=e.get();t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";for(var a in n)t[a]=n[a];for(var o=n.offset||{x:0,y:0},r=0,s=i.length;r<s;r++){var g=i[r].geometry._coordinates||i[r].geometry.coordinates;t.fillText(i[r].text,g[0]+o.x,g[1]+o.y)}}},_t={draw:function(t,e,n){var i=e instanceof v?e.get():e;t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";for(var a=0,o=i.length;a<o;a++)if(i[a].geometry){var r=i[a].icon,s=i[a].geometry._coordinates||i[a].geometry.coordinates;t.drawImage(r,s[0]-r.width/2,s[1]-r.height/2)}}};k.prototype.argCheck=function(t){"heatmap"==t.draw&&t.strokeStyle&&console.warn("[heatmap] options.strokeStyle is discard, pleause use options.strength [eg: options.strength = 0.1]")},k.prototype.init=function(t){var e=this;e.options=t,e.intensity=new n({maxSize:e.options.maxSize,gradient:e.options.gradient,max:e.options.max}),e.category=new S(e.options.splitList),e.choropleth=new R(e.options.splitList)},k.prototype.show=function(){this.map.addOverlay(this.canvasLayer)},k.prototype.hide=function(){this.map.removeOverlay(this.canvasLayer)},k.prototype.update=function(t){var e=this,n=t.options,i=e.options;for(var a in n)i[a]=n[a];e.init(i),e.canvasLayer.draw()},k.prototype.set=function(t){var e={globalAlpha:1,globalCompositeOperation:"source-over",imageSmoothingEnabled:!0,strokeStyle:"#000000",fillStyle:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,lineDashOffset:0,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic"},n=this,i=n.canvasLayer.canvas.getContext("2d");for(var a in e)i[a]=e[a];n.init(t.options),n.canvasLayer.draw()};var Mt="undefined"==typeof window?{}:window;Mt.google&&Mt.google.maps&&(A.prototype=new google.maps.OverlayView,A.DEFAULT_PANE_NAME_="overlayLayer",A.CSS_TRANSFORM_=function(){for(var t=document.createElement("div"),e=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],n=0;n<e.length;n++){var i=e[n];if(void 0!==t.style[i])return i}return e[0]}(),A.prototype.requestAnimFrame_=Mt.requestAnimationFrame||Mt.webkitRequestAnimationFrame||Mt.mozRequestAnimationFrame||Mt.oRequestAnimationFrame||Mt.msRequestAnimationFrame||function(t){return Mt.setTimeout(t,1e3/60)},A.prototype.cancelAnimFrame_=Mt.cancelAnimationFrame||Mt.webkitCancelAnimationFrame||Mt.mozCancelAnimationFrame||Mt.oCancelAnimationFrame||Mt.msCancelAnimationFrame||function(t){},A.prototype.setOptions=function(t){void 0!==t.animate&&this.setAnimate(t.animate),void 0!==t.paneName&&this.setPaneName(t.paneName),void 0!==t.updateHandler&&this.setUpdateHandler(t.updateHandler),void 0!==t.resizeHandler&&this.setResizeHandler(t.resizeHandler),void 0!==t.resolutionScale&&this.setResolutionScale(t.resolutionScale),void 0!==t.map&&this.setMap(t.map)},A.prototype.setAnimate=function(t){this.isAnimated_=!!t,this.isAnimated_&&this.scheduleUpdate()},A.prototype.isAnimated=function(){return this.isAnimated_},A.prototype.setPaneName=function(t){this.paneName_=t,this.setPane_()},A.prototype.getPaneName=function(){return this.paneName_},A.prototype.setPane_=function(){if(this.isAdded_){var t=this.getPanes();if(!t[this.paneName_])throw new Error('"'+this.paneName_+'" is not a valid MapPane name.');t[this.paneName_].appendChild(this.canvas)}},A.prototype.setResizeHandler=function(t){this.resizeHandler_=t},A.prototype.setResolutionScale=function(t){"number"==typeof t&&(this.resolutionScale_=t,this.resize_())},A.prototype.setUpdateHandler=function(t){this.updateHandler_=t},A.prototype.onAdd=function(){this.isAdded_||(this.isAdded_=!0,this.setPane_(),this.resizeListener_=google.maps.event.addListener(this.getMap(),"resize",this.resizeFunction_),this.centerListener_=google.maps.event.addListener(this.getMap(),"center_changed",this.repositionFunction_),this.resize_(),this.repositionCanvas_())},A.prototype.onRemove=function(){this.isAdded_&&(this.isAdded_=!1,this.topLeft_=null,this.canvas.parentElement.removeChild(this.canvas),this.centerListener_&&(google.maps.event.removeListener(this.centerListener_),this.centerListener_=null),this.resizeListener_&&(google.maps.event.removeListener(this.resizeListener_),this.resizeListener_=null),this.requestAnimationFrameId_&&(this.cancelAnimFrame_.call(Mt,this.requestAnimationFrameId_),this.requestAnimationFrameId_=null))},A.prototype.resize_=function(){if(this.isAdded_){var t=this.getMap(),e=t.getDiv().offsetWidth,n=t.getDiv().offsetHeight,i=e*this.resolutionScale_,a=n*this.resolutionScale_,o=this.canvas.width,r=this.canvas.height;o===i&&r===a||(this.canvas.width=i,this.canvas.height=a,this.needsResize_=!0,this.scheduleUpdate()),this.canvasCssWidth_===e&&this.canvasCssHeight_===n||(this.canvasCssWidth_=e,this.canvasCssHeight_=n,this.canvas.style.width=e+"px",this.canvas.style.height=n+"px")}},A.prototype.draw=function(){this.repositionCanvas_()},A.prototype.repositionCanvas_=function(){var t=this.getMap(),e=t.getBounds().getNorthEast().lat(),n=t.getCenter(),i=Math.pow(2,t.getZoom()),a=n.lng()-180*this.canvasCssWidth_/(256*i);this.topLeft_=new google.maps.LatLng(e,a);var o=this.getProjection(),r=o.fromLatLngToDivPixel(n),s=-Math.round(this.canvasCssWidth_/2-r.x),g=-Math.round(this.canvasCssHeight_/2-r.y);this.canvas.style[A.CSS_TRANSFORM_]="translate("+s+"px,"+g+"px)",this.scheduleUpdate()},A.prototype.update_=function(){this.requestAnimationFrameId_=null,this.isAdded_&&(this.isAnimated_&&this.scheduleUpdate(),this.needsResize_&&this.resizeHandler_&&(this.needsResize_=!1,this.resizeHandler_()),this.updateHandler_&&this.updateHandler_())},A.prototype.getTopLeft=function(){return this.topLeft_},A.prototype.scheduleUpdate=function(){this.isAdded_&&!this.requestAnimationFrameId_&&(this.requestAnimationFrameId_=this.requestAnimFrame_.call(Mt,this.requestUpdateFunction_))});var bt="undefined"==typeof window?{}:window;bt.EzMap&&(F.prototype=new ol.MapPane,F.prototype.initialize=function(t){this._map=t;var e=this.canvas=document.createElement("canvas");e.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";",e.style.mixBlendMode=this.mixBlendMode,this.adjustSize(),this.setElement(e),this.setMap(t);var n=this;return t.on("resize",function(){n.adjustSize(),n._draw()}),t.once("postrender",function(){n._draw()}),this.canvas},F.prototype.onRemove=function(){var t=this;map.un("resize",function(){t.adjustSize(),t._draw()})},F.prototype.adjustSize=function(){var t=this._map.getSize(),e=this.canvas,n=this.devicePixelRatio=bt.devicePixelRatio;e.width=t[0]*n,e.height=t[1]*n,e.getContext("2d").scale(n,n),e.style.width=t.width+"px",e.style.height=t.height+"px"},F.prototype.draw=function(){var t=this;clearTimeout(t.timeoutID),t.timeoutID=setTimeout(function(){t._draw()},15)},F.prototype._draw=function(){var t=this._map,e=t.getSize(),n=t.getCenter();if(n){var i=t.getPixelFromCoordinate(n.getCoordinate());this.canvas.style.left=i[0]-e.width/2+"px",this.canvas.style.top=i[1]-e.height/2+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.call(this)}},F.prototype.getContainer=function(){return this.canvas},F.prototype.show=function(){this.canvas.style.display="block"},F.prototype.hide=function(){this.canvas.style.display="none"},F.prototype.setZIndex=function(t){this.canvas.style.zIndex=t},F.prototype.getZIndex=function(){return this.zIndex}),D.prototype.argCheck=function(t){"heatmap"==t.draw&&t.strokeStyle&&console.warn("[heatmap] options.strokeStyle is discard, pleause use options.strength [eg: options.strength = 0.1]")},D.prototype.init=function(t){var e=this;e.options=t,e.intensity=new n({maxSize:e.options.maxSize,gradient:e.options.gradient,max:e.options.max}),e.category=new S(e.options.splitList),e.choropleth=new R(e.options.splitList)},D.prototype.update=function(t){var e=this,n=t.options,i=e.options;for(var a in n)i[a]=n[a];e.init(i),e.canvasLayer.draw()},D.prototype.set=function(t){var e={globalAlpha:1,globalCompositeOperation:"source-over",imageSmoothingEnabled:!0,strokeStyle:"#000000",fillStyle:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,lineDashOffset:0,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic"},n=this,i=n.canvasLayer.canvas.getContext("2d");for(var a in e)i[a]=e[a];n.init(t.options),n.canvasLayer.draw()},D.prototype.show=function(){this.canvasLayer.show()},D.prototype.hide=function(){this.canvasLayer.hide()},D.prototype.onRemove=function(t){this.canvasLayer.onRemove(),this.map=t;var e=this;"time"==this.options.draw||isEnabledTime?t.un("moveend",function(){e.animator.start()}):t.un("moveend",function(){e.canvasLayer._draw()}),t.un("pointerdrag",function(){var t=canvasLayer.canvas.getContext("2d");u(t)}),t.removeMapEventListener(Ez.Event.MAP_ZOOMCHANGE,function(){var t=canvasLayer.canvas.getContext("2d");u(t)}),this.options.methods&&this.options.methods.click&&t.removeMapEventListener("singleclick",function(t){for(var n=t.pixel,i=e.canvasLayer.canvas.getContext("2d"),a=dataSet.get(),o=0;o<a.length;o++)i.beginPath(),at.draw(i,a[o],e.options),i.isPointInPath(n[0]*e.canvasLayer.devicePixelRatio,n[1]*e.canvasLayer.devicePixelRatio)&&e.options.methods.click(a[o],t)}),this.canvasLayer.disposeInternal()};var St={getDataSet:function(t){for(var e=[],n=t.features,i=0;i<n.length;i++){var a=n[i],o=a.geometry,r=a.properties,s={};for(var g in r)s[g]=r[g];s.geometry=o,e.push(s)}return new v(e)}},Rt={CSVToArray:function(t,e){
e=e||",";for(var n=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),i=[[]],a=null;a=n.exec(t);){var o=a[1];o.length&&o!==e&&i.push([]);var r;r=a[2]?a[2].replace(new RegExp('""',"g"),'"'):a[3],i[i.length-1].push(r)}return i},getDataSet:function(t){for(var e=this.CSVToArray(t,","),n=[],i=e[0],a=1;a<e.length-1;a++){for(var o=e[a],r={},s=0;s<o.length;s++){var g=o[s];"geometry"==i[s]&&(g=JSON.parse(g)),r[i[s]]=g}n.push(r)}return new v(n)}};t.version=B,t.x=O,t.X=O,t.Flate=i,t.Earth=a,t.canvasClear=u,t.canvasResolutionScale=d,t.canvasDrawSimple=ot,t.canvasDrawHeatmap=st,t.canvasDrawGrid=gt,t.canvasDrawHoneycomb=ht,t.utilCityCenter=lt,t.utilCurve=pt,t.utilForceEdgeBundling=ut,t.utilDataRangeIntensity=n,t.utilDataRangeCategory=S,t.utilDataRangeChoropleth=R,t.Timer=dt,t.Animator=L,t.Map=wt,t.baiduMapCanvasLayer=H,t.baiduMapLayer=k,t.googleMapCanvasLayer=A,t.googleMapLayer=I,t.ezMapCanvasLayer=F,t.ezMapLayer=D,t.DataSet=v,t.geojson=St,t.csv=Rt});